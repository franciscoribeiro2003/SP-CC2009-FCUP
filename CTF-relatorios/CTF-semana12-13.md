# Desafio 1

## Objetivo
- Ligamos ao server ao executar `nc ctf-sp.dcc.fc.up.pt 6000`;
- No terminal foi nos dada uma mensagem cifrada por RSA:
  ```shell
  seed@VM:~$ nc ctf-sp.dcc.fc.up.pt 6000
  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d74751e7a496e575d6f61155f257d7d1f3155c2db2118e46443e3f7aae35ef90684312cdaedd71f31a9bc5830b0f5acda606e38dc75f036a812824bc7cc631e8941b193f5f6cb0cb39571d35c41a3acd77e500bf0df01dc55b0542ffa2b20c6fcf617a0043a4811a2562696601332f5e4590ee68628139dcbbd0d99e700aa8f0
  ```
- Encontrar os números primos p e q secretos;
- Calcular o expoente privado d utilizando p e q;
- Recuperar a flag dada usando o d;

Precisamos então de decifrar a mensagem:
  
  ## Decifrar
  Completamos então o ficheiro que nos foi dado, dando valores a p,q,n,e e d:
  
  template.py
  ```python
from binascii import hexlify, unhexlify
import sympy

p = sympy.nextprime(2**512,ith=1)
q = sympy.nextprime(2**513,ith=1)
n = p*q
e = 0x10001 # a constant

phi = (p - 1) * (q - 1)

d = sympy.mod_inverse(e, phi)

enc_flag = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000178ab79098451e088c4169976a96496f1829904ee6295c8aface584c25a2c8f423936847a253085ca9be2e7e1cf06d324da32502936c521869b91a0af7919d1b62e4fc1a8e38400481c12f39a614a841561b82da8aa45732917d102e727e2b56fe6bbd1efb34e68b351bdfd36a46a1e604485fbfbee0efbdfdcea734cc1556f44"

def enc(x):
	int_x = int.from_bytes(x, "big")
	y = pow(int_x,e,n)
	return hexlify(y.to_bytes(256, 'big'))

def dec(y):
	int_y = int.from_bytes(unhexlify(y), "big")
	x = pow(int_y,d,n)
	return x.to_bytes(256, 'big')

y = dec(enc_flag)
print(y.decode())

  ```
  Ao exucutar o programa `python3 template.py` foi nos dada a flag:
  ```
  flag{109ff208b136b757518f95146590b26c}
  ```
  
  # Desafio 2
  Começamos por conectar ao server no qual obttivemos uma mensagem:
  ![image](https://github.com/DCC-FCUP-SP/sp2223-t02g10/assets/102924343/cb24ac48-9e30-4fce-9e0b-0a60af2ff257)
  
 ```messages
 Message 1
N: 29802384007335836114060790946940172263849688074203847205679161119246740969024691447256543750864846273960708438254311566283952628484424015493681621963467820718118574987867439608763479491101507201581057223558989005313208698460317488564288291082719699829753178633499407801126495589784600255076069467634364857018709745459288982060955372620312140134052685549203294828798700414465539743217609556452039466944664983781342587551185679334642222972770876019643835909446132146455764152958176465019970075319062952372134839912555603753959250424342115581031979523075376134933803222122260987279941806379954414425556495125737356327411
E: 65537
42460e87af51f5c47c4ff5ca36ed9dac3791fc96df9361c493a72bc4addf6903a20b6dbeac7299331a6ae3d23ad1d22c4542496743c2a9455d9f6d440096d63e417f4bcbdad1030a9c9ae5beb45158f78670af811661710ba0d74a776fc1c9e9a0e7fccd6354e0e6e9fef37b1a14286b4dbef735ba26b19c8848893ca8f1f8916def0e125a5d9a90c60b416c4169ad9dde3240eff472b44bfde31cc3501c912fa66572ffcc444236d6d1e6ae88d87e4bdfed5452addc0623f42952d6a74b6a63fc2036d0cbd22e9a5dbce876f86b9a0ecbe6632bb55f85ca88de61f2f12966fd783a9a476841a0525c81a9485490a8df8cbaa74b5d4854abeda4c76dfb6c7555
Message 2
N: 29802384007335836114060790946940172263849688074203847205679161119246740969024691447256543750864846273960708438254311566283952628484424015493681621963467820718118574987867439608763479491101507201581057223558989005313208698460317488564288291082719699829753178633499407801126495589784600255076069467634364857018709745459288982060955372620312140134052685549203294828798700414465539743217609556452039466944664983781342587551185679334642222972770876019643835909446132146455764152958176465019970075319062952372134839912555603753959250424342115581031979523075376134933803222122260987279941806379954414425556495125737356327411
E: 65539
3ce10ea16ea00f060a3b4dc0cd2b1bf2ec37bcb73bd085e117725a02839115ddbc8d84eced5620a8e1cd3450bf295f82834c562c6a5cc2b650f4af5b22f5b03b1b6d59b5db279646df38ef769640b49d165d125988fe8591a7b8c43e0a31934e3210b505974a2a734da756b21617dff8e0184055d57d495bedaf4b04fd9c4b886864822869ae8daf9a1bcd4e8ac5610b0bb22568c6d558d07557ae91ec61541e6d41457715a9168a99598b3f15503b7e7955694b4b1bfaa187da8dde82df3877563de93bff82d6e4af4da5e14ed01403d16ee34a5ca5b1e161c087063f13a7aaa7d544e172272176fe7c567868ca439f7d1d2de1f047da3350575207acc9bff0

```
```python
from binascii import hexlify, unhexlify

# Mensagens enviadas pelo servidor
c1 = int.from_bytes(unhexlify(b"42460e87af51f5c47c4ff5ca36ed9dac3791fc96df9361c493a72bc4addf6903a20b6dbeac7299331a6ae3d23ad1d22c4542496743c2a9455d9f6d440096d63e417f4bcbdad1030a9c9ae5beb45158f78670af811661710ba0d74a776fc1c9e9a0e7fccd6354e0e6e9fef37b1a14286b4dbef735ba26b19c8848893ca8f1f8916def0e125a5d9a90c60b416c4169ad9dde3240eff472b44bfde31cc3501c912fa66572ffcc444236d6d1e6ae88d87e4bdfed5452addc0623f42952d6a74b6a63fc2036d0cbd22e9a5dbce876f86b9a0ecbe6632bb55f85ca88de61f2f12966fd783a9a476841a0525c81a9485490a8df8cbaa74b5d4854abeda4c76dfb6c7555"),"big")
c2 = int.from_bytes(unhexlify(b"3ce10ea16ea00f060a3b4dc0cd2b1bf2ec37bcb73bd085e117725a02839115ddbc8d84eced5620a8e1cd3450bf295f82834c562c6a5cc2b650f4af5b22f5b03b1b6d59b5db279646df38ef769640b49d165d125988fe8591a7b8c43e0a31934e3210b505974a2a734da756b21617dff8e0184055d57d495bedaf4b04fd9c4b886864822869ae8daf9a1bcd4e8ac5610b0bb22568c6d558d07557ae91ec61541e6d41457715a9168a99598b3f15503b7e7955694b4b1bfaa187da8dde82df3877563de93bff82d6e4af4da5e14ed01403d16ee34a5ca5b1e161c087063f13a7aaa7d544e172272176fe7c567868ca439f7d1d2de1f047da3350575207acc9bff0"),"big")

# Chaves públicas de c1 e c2
e1 = 0x10001
e2 = 0x10003

# valor n
n = 29802384007335836114060790946940172263849688074203847205679161119246740969024691447256543750864846273960708438254311566283952628484424015493681621963467820718118574987867439608763479491101507201581057223558989005313208698460317488564288291082719699829753178633499407801126495589784600255076069467634364857018709745459288982060955372620312140134052685549203294828798700414465539743217609556452039466944664983781342587551185679334642222972770876019643835909446132146455764152958176465019970075319062952372134839912555603753959250424342115581031979523075376134933803222122260987279941806379954414425556495125737356327411


# Função do algoritmo estendido de Euclides para calcular o mdc e os coeficientes a e b
def extended_euclidean(a, b):
    if b == 0:
        return (a, 1, 0)
    gcd, x, y = extended_euclidean(b, a % b)
    return (gcd, y, x - (a // b) * y)

# Calculando os coeficientes a e b usando o algoritmo estendido de Euclides
(gcd,a,b) = extended_euclidean(e1, e2)

# Calculando o inverso modular de c2
i = pow(c2, -1, n)

# Convertendo a mensagem em bytes e decodificando para texto
m = (pow(c1,a,n)*pow(i,-b,n)) % n

m = m.to_bytes(256,'big')
message=m.decode()

print(message)
```


Neste script, há algumas etapas importantes:

    - As mensagens enviadas pelo servidor são convertidas de bytes hexadecimais para números inteiros e armazenadas nas variáveis c1 e c2.

    - As chaves públicas e1 e e2 são definidas.

    - O valor n é definido como o produto dos módulos das chaves públicas.

    - É definida a função extended_euclidean(a, b) para calcular o máximo divisor comum (mdc) entre a e b e encontrar os coeficientes a e b através do algoritmo estendido de Euclides.

    - Utilizando o algoritmo estendido de Euclides, são calculados os coeficientes a e b usando as chaves públicas e1 e e2.

    - O inverso modular de c2 é calculado usando a função pow().

    - A mensagem original é recuperada aplicando a fórmula m = (c1^a * i^(-b)) mod n.

    - A mensagem é convertida em bytes e decodificada para texto.


![image](https://github.com/DCC-FCUP-SP/sp2223-t02g10/assets/102924343/96c9d1d5-1266-43ab-8c06-46d09b12ed97)

```
flag{8dc07f965608b8ae7b523c577d5da266}
```
